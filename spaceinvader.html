<!DOCTYPE html>
<html>
<head>
	<style>
canvas{
    background-image: url("img/space.gif");
    height: 600px;
    width: 900px;
    background-size: cover;
    position: absolute;
    float: left;
    left: 21%;
    top: 2%;
}
button{
	width: 8%;
	height: 4%;
	position: absolute;
    float: left;
    left: 44%;
    top: 40%;
     background-image: url("img/space.gif");
     color: white;
}
</style>
		<title>Shooter JS Game</title>
	</head>
<body>
		<canvas id="mainCanvas" style="background-color: lightgrey"></canvas>
		<button id="play" onClick="game()">Play Game</button>
		<h3 id="scoreText"></h3>
		<script type="text/javascript">
//Enemy constructor
function enemy(x,y,color,w,h){
	this.image = new Image();
    this.image.src = color;
	this.x = x;
	this.y = y;
	this.w = w;
	this.h = h;
	this.speed = 50;
	this.show = function(){ctx.drawImage(this.image, 
                this.x, 
                this.y,
                this.w, this.h);
	}
	this.move = function(speed){
		this.clear();
		this.y += speed;
		this.show();	
	}
	this.clear = function(){
		ctx.clearRect(this.x,this.y,this.w,this.h);
	}
}
//Bullet constructor
function bullet(x,y,color,w,h){
	this.image = new Image();
    this.image.src = color;
	this.x = x;
	this.y = y;
	this.w = w;
	this.h = h;
	this.show = function(){ctx.drawImage(this.image, 
                this.x, 
                this.y,
                this.w, this.h);
	}

	this.move = function(){
		this.clear();
		this.y -= 5;
		this.show();
	}
	this.clear = function(){
		ctx.clearRect(this.x,this.y,this.w,this.h);
	}

	this.hits = function(bullet, enemy){
		if(bullet.y < enemy.y + enemy.h +10 && bullet.x < enemy.x + enemy.w && bullet.x > enemy.x - 3){
			return(true);
		}
	}

}
//Player constructure
function player(x,y,color,w,h){
	this.image = new Image();
        this.image.src = color;
	this.x = x;
	this.y = y;
	this.w = w;
	this.h = h;

	this.show = function(){
		ctx.drawImage(this.image, 
                this.x, 
                this.y,
                this.w, this.h);
		if(this.x <= 0) this.x = 0;
		if(this.x >= canvas.width - this.w) this.x = canvas.width - this.w;
	}

	this.move = function(dir){
		this.clear();
		this.x += dir;
		this.show();
	}

	this.clear = function(){
		ctx.clearRect(this.x,this.y,this.w,this.h);

	}
}
var myMusic;
var canvas = document.getElementById("mainCanvas");
var ctx = canvas.getContext("2d");
function game(){
     myMusic = new sound("Snow.mp3");
	myMusic.play();
document.getElementById("play").style.visibility= "hidden";
var playerOne = new player(canvas.width/2,canvas.height-20,"img/hero2.png",20,20);
var bullets = [];
var enemies = [];
var enemySpeed = 1;
var score = 0;
var level = 0;
//Draws enemies
function drawEnemies(yPos){
for(var i = 0; i < 7; i++){
	var enemyOne = new enemy(i*40,-20+yPos,"img/alien2.png",20,20);
	enemies.push(enemyOne);
	enemies[i].show();
}
}

//Main game loop
function update(){
	playerOne.show();
	document.getElementById("scoreText").innerHTML = score;
	//Shoot the bullets and checks if they hit an enemy
	for(var i = 0; i < bullets.length; i++){
		bullets[i].move();
		for(var j = 0; j < enemies.length; j++){
			if(bullets[i].hits(bullets[i],enemies[j])){
			enemies[j].clear();
			bullets[i].clear();
			enemies.splice(j,1);
			score += 100;
			level++;	
		}
	}
	if(bullets[i].y <= 0 ){ 
		bullets[i].clear();
		bullets.splice(i,1);
	}
	}
	if(enemies.length <= 0){
		drawEnemies(20);
		enemySpeed += 1;
	}
	
	window.requestAnimationFrame(update);
}
var enemyMove = setInterval(function(){
	for(var i = 0; i < enemies.length; i++){
	 	enemies[i].move(enemySpeed);
	 	if(enemies[i].y > 130){
	 		lost();
	 		clearInterval(enemyMove);
	 	}
	}
},200);

function lost(){
	myMusic.stop();

	setInterval(function(){
	 ctx.fillStyle = "red";
	 ctx.font = "40px Arial";
	 ctx.fillText("GAME OVER",10,30);
	 ctx.font = "24px Arial";
	 ctx.fillText("Your Score Was: " + score,10,80);
	 ctx.font = "24px Arial";
	 ctx.fillText("Your Killed: " + level + " Enemies",10,130);
	},50);


}
function sound(src) {
    this.sound = document.createElement("audio");
    this.sound.src = src;
    this.sound.setAttribute("preload", "auto");
    this.sound.setAttribute("controls", "none");
    this.sound.style.display = "none";
    document.body.appendChild(this.sound);
    this.play = function(){
        this.sound.play();
    }
    this.stop = function(){
        this.sound.pause();
    }    
}

//Key Press functions
window.addEventListener("keydown",function(event){
	if(event.keyCode == 37) {
		playerOne.move(-10);
	}
	if(event.keyCode == 39) {
		playerOne.move(10);
	}
	if(event.keyCode == 32){
		var bulletOne = new bullet(playerOne.x + 7, playerOne.y, "img/balle2.png",10, 10);
		bullets.push(bulletOne);
	}
});

update();

}

</script>

	
		
	</body>
	</html>


